<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta http-equiv="X-UA-Compatible" content="IE=Edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>test</title>
      <style>
         body {
         margin: 0;
         padding: 0;
         overflow: hidden;
         background-color: #f5f5f5;
         font-family: Arial, sans-serif;
         user-select: none;
         -webkit-user-select: none;
         -moz-user-select: none;
         -khtml-user-select: none;
         -ms-user-select: none;
         width: 100%;
         height: 100%;
         }
         #game-container {
         width: 100vw;
         height: 100vh;
         background-color: #f5f5f5;
         font-family: Arial, sans-serif;
         user-select: none;
         -webkit-user-select: none;
         -moz-user-select: none;
         -khtml-user-select: none;
         -ms-user-select: none;
         }
      </style>
   </head>
   <body>
      <div id="sprite"></div>
      <div id="game-container">
      <div id="joystick-container" class="joystick-container">
      </div>
      <script defer type="module">
         class VirtualJoystick {
         constructor(container, options = {}) {
          this.container = container;
          this.options = Object.assign({
            width: 100,
            height: 100,
            color: 'gray',
            handleColor: 'white',
            handleRadius: 20,
            onChange: null,
          }, options);
         
          this.joystick = document.createElement('div');
          this.joystick.style.width = `${this.options.width}px`;
          this.joystick.style.height = `${this.options.height}px`;
          this.joystick.style.borderRadius = '50%';
          this.joystick.style.backgroundColor = this.options.color;
          this.joystick.style.position = 'relative';
          this.joystick.style.touchAction = 'none';
          this.joystick.style.border = '3px solid black';
          this.joystick.style.opacity = '50%'
          this.container.appendChild(this.joystick);
         
          this.handle = document.createElement('div');
          this.handle.style.width = `${this.options.handleRadius * 2}px`;
          this.handle.style.height = `${this.options.handleRadius * 2}px`;
          this.handle.style.borderRadius = '50%';
          this.handle.style.backgroundColor = this.options.handleColor;
          this.handle.style.position = 'absolute';
          this.handle.style.top = `${this.options.height / 2 - this.options.handleRadius}px`;
          this.handle.style.left = `${this.options.width / 2 - this.options.handleRadius}px`;
          this.handle.style.touchAction = 'none';
          this.joystick.appendChild(this.handle);
         
          this.position = { x: 0, y: 0 };
          this.delta = { x: 0, y: 0 };
          this.handleRadius = this.options.handleRadius;
          this.joystickRect = this.joystick.getBoundingClientRect();
         
          this.isPressed = false;
          this.touchId = null;
         
          this._addEventListeners();
         }
         
         _addEventListeners() {
          this.handle.addEventListener('mousedown', this._handleMouseDown.bind(this));
          document.addEventListener('mouseup', this._handleMouseUp.bind(this));
          this.handle.addEventListener('touchstart', this._handleTouchStart.bind(this));
          document.addEventListener('touchend', this._handleTouchEnd.bind(this));
          document.addEventListener('touchcancel', this._handleTouchEnd.bind(this));
          document.addEventListener('touchmove', this._handleTouchMove.bind(this));
         }
         
         _handleMouseDown(event) {
          this.isPressed = true;
          this._updatePosition(event.clientX, event.clientY);
         }
         
         _handleMouseUp() {
          this.isPressed = false;
          this._updatePosition(this.joystickRect.left + this.options.width / 2, this.joystickRect.top + this.options.height / 2);
         }
         
         _handleTouchStart(event) {
          if (this.touchId === null) {
            this.touchId = event.changedTouches[0].identifier;
            this.isPressed = true;
            this._updatePosition(event.changedTouches[0].clientX, event.changedTouches[0].clientY);
          }
         }
         
         _handleTouchEnd(event) {
          for (let i = 0; i < event.changedTouches.length; i++) {
            if (event.changedTouches[i].identifier === this.touchId) {
              this.touchId = null;
              this.isPressed = false;
              this._updatePosition(this.joystickRect.left + this.options.width / 2, this.joystickRect.top + this.options.height / 2);
              break;
            }
          }
         }
         
         _handleTouchMove(event) {
          for (let i = 0; i < event.changedTouches.length; i++) {
            if (event.changedTouches[i].identifier === this.touchId) {
              this._updatePosition(event.changedTouches[i].clientX,event.changedTouches[i].clientY);
              break;
              }
              }
              }
              
              _updatePosition(x, y) {
                const dx = x - this.joystickRect.left - this.options.width / 2;
                const dy = y - this.joystickRect.top - this.options.height / 2;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance > this.handleRadius) {
                  const angle = Math.atan2(dy, dx);
                  this.position = { x: Math.cos(angle) * this.handleRadius, y: Math.sin(angle) * this.handleRadius };
                } else {
                  this.position = { x: dx, y: dy };
                }
              
                this.delta = { x: this.position.x / this.handleRadius, y: this.position.y / this.handleRadius };
              
                this.handle.style.transform = `translate(${this.position.x}px, ${this.position.y}px)`;
              
                if (typeof this.options.onChange === 'function') {
                  this.options.onChange(this.delta);
                }
              }
              }
         
         
         // Define constants for the game
         const GAME_WIDTH = window.innerWidth;
         const GAME_HEIGHT = window.innerHeight;
         
         // Create the game container
         const gameContainer = document.getElementById('game-container');
         
         document.body.appendChild(gameContainer);
         
         // Create a score element
         const scoreElem = document.createElement('div');
         scoreElem.style.position = 'absolute';
         scoreElem.style.top = '20px';
         scoreElem.style.left = '20px';
         scoreElem.style.color = 'black';
         scoreElem.style.fontSize = '24px';
         scoreElem.textContent = 'Score: 0';
         
         gameContainer.appendChild(scoreElem);
         
         // Define the score variable
         let score = 0;
         
         
         // Load the sprite image
         const sprite = new Image();
         sprite.src = 'sprite.png';
         sprite.addEventListener('load', function() {
         // Set the sprite's dimensions
         sprite.style.width = '50px';
         sprite.style.height = '50px';
         sprite.style.position = 'absolute';
         
         // Set the sprite's initial position
         spriteObj.x = GAME_WIDTH / 2 - sprite.width / 2;
         spriteObj.y = GAME_HEIGHT / 2 - sprite.height / 2;
         
         // Add the sprite to the game container
         gameContainer.appendChild(sprite);
         });
         
         const ball = new Image();
         ball.src = 'gball.png';
         ball.addEventListener('load', function() {
         // Set the ball's dimensions
         ball.style.width = '30px';
         ball.style.height = '30px';
         ball.style.position = 'absolute';
         // Set the ball's initial position
         resetBall();
         // Add the ball to the game container
         gameContainer.appendChild(ball);
         });
         const ballObj = {
         x: 0,
         y: 0,
         speed: 300, // pixels per second
         };
         // Define the initial position of the ball
         let ballX = Math.floor(Math.random() * (GAME_WIDTH - ball.width));
         let ballY = Math.floor(Math.random() * (GAME_HEIGHT - ball.height));
         
         function resetBall() {
         ballObj.x = Math.random() * (GAME_WIDTH - ball.width);
         ballObj.y = Math.random() * (GAME_HEIGHT - ball.height);
         ball.style.left = ballObj.x + 'px';
         ball.style.top = ballObj.y + 'px';
         }
         
         
         // Create a virtual joystick for controlling the sprite
         const joystickContainer = document.createElement('div');
         joystickContainer.style.position = 'absolute';
         joystickContainer.style.bottom = '20px';
         joystickContainer.style.left = '20px';
         gameContainer.appendChild(joystickContainer);
         const joystick = new VirtualJoystick(joystickContainer);
         
         // Define the sprite object
         const spriteObj = {
         x: 0,
         y: 0,
         speed: 500, // pixels per second
         };
         
         // Define the game loop
         let lastTime = 0;
         
         function gameLoop(timestamp) {
         const deltaTime = (timestamp - lastTime) / 1000;
         lastTime = timestamp;
         
         // Move the sprite based on joystick input
         spriteObj.x += joystick.delta.x * spriteObj.speed * deltaTime;
         spriteObj.y += joystick.delta.y * spriteObj.speed * deltaTime;
         
         // Keep the sprite within the game bounds
         if (spriteObj.x < 0) spriteObj.x = 0;
         if (spriteObj.y < 0) spriteObj.y = 0;
         if (spriteObj.x + sprite.width > GAME_WIDTH) spriteObj.x = GAME_WIDTH - sprite.width;
         if (spriteObj.y + sprite.height > GAME_HEIGHT) spriteObj.y = GAME_HEIGHT - sprite.height;
         
         // Update the sprite position
         sprite.style.left = spriteObj.x + 'px';
         sprite.style.top = spriteObj.y + 'px';
         
         
         
         // Bounce the ball off the walls
         if (ballObj.x < 0 || ballObj.x + ball.width > GAME_WIDTH) {
         ballObj.x -= ballX;
         }
         if (ballObj.y < 0 || ballObj.y + ball.height > GAME_HEIGHT) {
         ballObj.y -= ballY;
         }
         
         // Update the ball position
         ball.style.left = ballObj.x + 'px';
         ball.style.top = ballObj.y + 'px';
         
         // Check for collisions with the ball
         if (spriteObj.x < ballObj.x + ball.width &&
          spriteObj.x + sprite.width > ballObj.x &&
          spriteObj.y < ballObj.y + ball.height &&
          spriteObj.y + sprite.height > ballObj.y) {
         // Reset the ball position and increase the score
         resetBall();
         score++;
         scoreElem.textContent = `Score: ${score}`;
         }
         
         
         // Request the next frame
         requestAnimationFrame(gameLoop);
         }
         
         // Start the game loop
         requestAnimationFrame(gameLoop);
         
      </script>
   </body>
</html>
